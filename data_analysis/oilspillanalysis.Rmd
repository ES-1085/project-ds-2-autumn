---
title: "Oil Spill Analysis"
author: "Autumn Pauly and Asher Panikian"
output: github_document
---

# Background Information
These data within the USFWS and USGS dataset was collected primarily during experimental harvests primarily conducted in the 1960's and 1970's, or during sea otter captures related to USFWS and USGS sea otter sampling and tagging studies conducted from the late 1980's up to and including 2019, or recovered dead during the 1989 Exxon Valdez Oil spill (EVOS).

We were interested to see if there were any differences between the otters that were captured before and after the oil spill.

# Loading the Data
First, we'll want to load the appropriate packages and data for the analysis of this dataset.

```{r loading-packages, echo = FALSE}
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
library(RColorBrewer)
library(stringr)
#install.packages("plotly")
#library(plotly)
#install.packages("gapminder")
#library(gapminder)
```

```{r reading-CSV, echo = FALSE}
#posit cloud
seot = read.csv("/cloud/project/data/seot.csv", h = T)

#computer
#seot = read.csv("~/GitHub/project-ds-2-autumn/project-ds-2-autumn/data/seot.csv", h = T)
```

# Analyzing the Data
### Otter's Weight before and after the Exxon Oil Spill
#### Creating Plots

```{r glimpsing-dead-otters-weight}
#sea otters after the oil spill
seot <- seot %>% 
  mutate(oil_spill = case_when(YEAR < 1989 ~ "before_oil_spill", 
                               YEAR > 1989 ~ "after_oil_spill"))

#adult weight
seot %>% 
  filter(FINAL_AGE > 4) %>% 
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  ggplot(mapping = aes(y = WEIGHT, x = oil_spill, fill = oil_spill)) + 
  geom_boxplot() +
  labs(title = "Adult Sea Otter Weight", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")

#otters aged 4 weight
seot %>% 
  filter(FINAL_AGE == "4") %>%
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  ggplot(mapping = aes(y = WEIGHT, x = oil_spill, fill = oil_spill)) + 
  geom_boxplot() +
  labs(title = "Sea Otter Aged 4 Weight", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")

#otters aged 3 weight
seot %>% 
  filter(FINAL_AGE == "3") %>% 
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  ggplot(mapping = aes(y = WEIGHT, x = oil_spill, fill = oil_spill)) + 
  geom_boxplot() +
  labs(title = "Sea Otter Aged 3 Weight", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")

#otters aged 2 weight
seot %>% 
  filter(FINAL_AGE == "2") %>%
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  ggplot(mapping = aes(y = WEIGHT, x = oil_spill, fill = oil_spill)) + 
  geom_boxplot() +
  labs(title = "Sea Otter Aged 2 Weight", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")

#otters aged 1 weight
seot %>% 
  filter(FINAL_AGE == "1") %>%
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  ggplot(mapping = aes(y = WEIGHT, x = oil_spill, fill = oil_spill)) + 
  geom_boxplot() +
  labs(title = "Sea Otter Aged 1 Weight", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")
```

#### Check the R-Squared

```{r r-squared-weight-oil}
# #now, let's create the linear model comparing weight to year
# seot_model_oilweight <- linear_reg() %>%
#   set_engine("lm") %>% 
#   fit(WEIGHT ~ oil_spill, data = seot)
# 
# #let's tidy this model
# seot_model_oilweight %>% tidy()
# 
# #augmenting the weight data
# seot_model_oilweight_augment <- augment(seot_model_oilweight$fit)
# 
# ggplot(seot_model_oilweight_augment, mapping = aes(x = .fitted, y = .resid)) +
#   geom_jitter(alpha = 0.75) +
#   geom_smooth(color = "black") +
#   labs(x = "Predicted weight", y = "Residuals")
# 
# #assessing the r-squared value
# glance(seot_model_oilweight)$adj.r.squared
```
The r-squared value is `0.03906333`, which means that the variable `oil_spill` accounts for 39% of the variation in the dependent variable, `WEIGHT`. 

#### Statistical Analysis

```{r stats-weight-oil}
#Welch's Two Sample t-test
t_test_weight <- t.test(WEIGHT ~ oil_spill, data = seot)
t_test_weight

#two-way ANOVA
two_anova_weight_oil <- aov(WEIGHT ~ oil_spill + FINAL_AGE + oil_spill:FINAL_AGE, data = seot)
summary(two_anova_weight_oil)

#interaction plot of data
interaction.plot(x.factor=seot$FINAL_AGE, trace.factor = seot$oil_spill, response = seot$WEIGHT, type = "o",pch=16)

```

The two-way ANOVA suggests that there is a statistical significance with the interaction between the two variables `FINAL_AGE` and `oil_spill` for the dependent variable `WEIGHT`, we will have to perform any analysis of simple events. For simplicity's sake, I will be categorizing the ages to juvenile (`0-4`) and adult (`>4`)

```{r simple-events-analysis-weight}

```

### Otter's Weight Year by Year

```{r otter-weight-by-year}
#all otters weight
seot %>% 
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  filter(SEX == "M"|SEX == "F") %>% 
  ggplot(mapping = aes(y = WEIGHT, x = YEAR, color = oil_spill)) + 
  geom_jitter() +
  geom_smooth(color = "black") +
  labs(title = "Adult Sea Otter Weight", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")

#all otters weight
seot %>% 
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  filter(SEX == "M"|SEX == "F") %>% 
  filter(FINAL_AGE > 4) %>% 
  ggplot(mapping = aes(y = WEIGHT, x = YEAR, color = oil_spill)) + 
  geom_jitter() +
  geom_smooth(color = "black") +
  labs(title = "Adult Sea Otter Weight", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")
```




### Otter's morphometric measurements before and after the Exxon Oil Spill
#### Creating Plots

```{r body_length-oil}
#adult body length
seot %>% 
  filter(FINAL_AGE > 4) %>% 
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  ggplot(mapping = aes(y = true_standard_lgth, x = oil_spill)) + 
  geom_boxplot() +
  labs(title = "Adult Sea Otter Body Length", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")

#otters aged 4 body length
seot %>% 
  filter(FINAL_AGE == "4") %>%
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  ggplot(mapping = aes(y = true_standard_lgth, x = oil_spill)) + 
  geom_boxplot() +
  labs(title = "Sea Otter Aged 4 Body Length", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")

#otters aged 3 body length
seot %>% 
  filter(FINAL_AGE == "3") %>% 
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  ggplot(mapping = aes(y = true_standard_lgth, x = oil_spill)) + 
  geom_boxplot() +
  labs(title = "Sea Otter Aged 3 Body Length", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")

#otters aged 2 body length
seot %>% 
  filter(FINAL_AGE == "2") %>%
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  ggplot(mapping = aes(y = true_standard_lgth, x = oil_spill)) + 
  geom_boxplot() +
  labs(title = "Sea Otter Aged 2 Body Length", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")

#otters aged 1 body length
seot %>% 
  filter(FINAL_AGE == "1") %>%
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  ggplot(mapping = aes(y = true_standard_lgth, x = oil_spill)) + 
  geom_boxplot() +
  labs(title = "Sea Otter Aged 1 Body Length", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")
```

#### Check the R-Squared

```{r stats-length-oilspill}
# #now, let's create the linear model comparing weight to year
# seot_model_oillength <- linear_reg() %>%
#   set_engine("lm") %>% 
#   fit(true_standard_lgth ~ oil_spill, data = seot)
# 
# #let's tidy this model
# seot_model_oillength %>% tidy()
# 
# #augmenting the weight data
# seot_model_oillength_augment <- augment(seot_model_oillength$fit)
# 
# ggplot(seot_model_oillength_augment, mapping = aes(x = .fitted, y = .resid)) +
#   geom_jitter(alpha = 0.75) +
#   geom_smooth(color = "black") +
#   labs(x = "Predicted weight", y = "Residuals")
# 
# #assessing the r-squared value
# glance(seot_model_oillength)$adj.r.squared
```

#### Statistical Analysis

```{r oil-length-statstest}
#Welch's Two Sample t-test
t_test_length <- t.test(true_standard_lgth ~ oil_spill, data = seot)
t_test_length

#two-way ANOVA
two_anova_lgth_oil <- aov(true_standard_lgth ~ oil_spill + FINAL_AGE + oil_spill:FINAL_AGE, data = seot)
summary(two_anova_lgth_oil)
```

With there being no statistical significance with the interaction between the two variables `FINAL_AGE` and `oil_spill` for the dependent variable `true_standard_length`, we don't have to perform any analysis of simple events. 

REPORT: There was no significant impact of the oil spill on the body length of the sea otter population (Two-way ANOVA; F_1,3375, f = 0.207, p=0.65). There was a significant impact on the age of the otter on the body length (Two-way ANOVA; F_1,3375, f = 2297.583, p < 0.0005). 

### Otter's Final Age before and after the Exxon Oil Spill
#### Creating Plots

```{r glimpsing-finalage-otters}
#plot of age at capture before and after oil spill
seot %>% 
  filter(oil_spill == "before_oil_spill"|oil_spill == "after_oil_spill") %>% 
  ggplot(mapping = aes(y = FINAL_AGE, x = oil_spill)) + 
  geom_boxplot() +
  labs(title = "Sea Otter Final Age", 
       subtitle = "before and after Exxon Oil Spill", 
       x = "")
```

#### Check the R-Squared

```{r r-squared-age-oil}
# #now, let's create the linear model comparing age to year
# seot_model_oilage <- linear_reg() %>%
#   set_engine("lm") %>% 
#   fit(FINAL_AGE ~ oil_spill, data = seot)
# 
# #let's tidy this model
# seot_model_oilage %>% tidy()
# 
# #augmenting the weight data
# seot_model_oilage_augment <- augment(seot_model_oilage$fit)
# 
# ggplot(seot_model_oilage_augment, mapping = aes(x = .fitted, y = .resid)) +
#   geom_jitter(alpha = 0.75) +
#   geom_smooth(color = "black") +
#   labs(x = "Predicted weight", y = "Residuals")
# 
# #assessing the r-squared value
# glance(seot_model_oilage)$adj.r.squared
```
The r-squared value is `0.04269101`, which means that the variable `oil_spill` accounts for 4.26% of the variation in the dependent variable, `WEIGHT`. 

#### Statistical Analysis

```{r stats-age-oil}
#Welch's Two Sample t-test
t_test_age <- t.test(FINAL_AGE ~ oil_spill, data = seot)
t_test_age

#one-way ANOVA
anova_age_oil <- aov(FINAL_AGE ~ oil_spill, data = seot)
summary(anova_age_oil)
TukeyHSD(anova_age_oil)
```

REPORT: The otters captured before the oil spill were significantly older than the otters captured after the oil spill (Welch Two Sample t-test; t = -12.825, df = 3472.6, p-value < 0.0005).



















